<!DOCTYPE html>
<html>
<head>
    <title>字符串与16进制双向转换工具</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #f0f2f5; }
        .container { background: white; border-radius: 10px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 25px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .card { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        textarea { width: 100%; height: 100px; padding: 12px; margin: 12px 0; border: 1px solid #ddd; border-radius: 6px; resize: vertical; font-family: monospace; }
        .flex { display: flex; gap: 15px; align-items: center; margin: 15px 0; }
        button { background: #3498db; color: white; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; transition: background 0.3s; font-weight: bold; }
        button:hover { background: #2980b9; }
        .output { background: #e8f4fc; padding: 15px; border-radius: 6px; margin-top: 15px; word-break: break-all; font-family: monospace; }
        .copy-btn { background: #27ae60; }
        .copy-btn:hover { background: #219653; }
        .switch-btn { background: #9b59b6; }
        .switch-btn:hover { background: #8e44ad; }
        label { font-weight: bold; color: #34495e; }
        select { padding: 8px; border-radius: 4px; border: 1px solid #ddd; }
        .hint { color: #7f8c8d; font-size: 0.9em; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>字符串 ⇄ 16进制转换工具</h1>
        
        <!-- 格式选择 -->
        <div class="card">
            <label for="format">输出格式：</label>
            <select id="format">
                <option value="slashx">\x 格式 (默认, 如 \x48\x65)</option>
                <option value="0x">0x 格式 (如 0x48 0x65)</option>
                <option value="space">空格分隔 (如 48 65)</option>
            </select>
            <div class="hint">提示：反向转换自动识别所有格式</div>
        </div>
        
        <!-- 正向转换区域 -->
        <div class="card">
            <h2>字符串 → 16进制</h2>
            <textarea id="inputString" placeholder="输入文本（如: Hello 世界）"></textarea>
            <button id="convertBtn">转换</button>
            
            <div class="output">
                <strong>转换结果：</strong>
                <div id="outputResult"></div>
                <button class="copy-btn" onclick="copyOutput()">复制结果</button>
            </div>
        </div>
        
        <!-- 反向转换区域 -->
        <div class="card">
            <h2>16进制 → 字符串</h2>
            <textarea id="inputHex" placeholder="输入16进制（如: \x48\x65 或 48 65）"></textarea>
            <button id="reverseBtn">反向转换</button>
            
            <div class="output">
                <strong>原始字符串：</strong>
                <div id="reverseResult"></div>
                <button class="copy-btn" onclick="copyReverse()">复制结果</button>
            </div>
        </div>
    </div>

    <script>
        // 核心转换函数（支持自定义格式）
        function stringToHex(str, format) {
            const encoder = new TextEncoder();
            const bytes = encoder.encode(str);
            let result = '';

            for (let byte of bytes) {
                const hexByte = byte.toString(16).padStart(2, '0');
                switch (format) {
                    case 'slashx':  // \x格式
                        result += `\\x${hexByte}`;
                        break;
                    case '0x':       // 0x格式
                        result += `0x${hexByte} `;
                        break;
                    default:         // 空格分隔
                        result += `${hexByte} `;
                }
            }
            return format === '0x' || format === 'space' ? result.trim() : result;
        }

        // 反向转换函数（自动识别格式）[3,5](@ref)
        function hexToString(hexInput) {
            // 统一处理格式：移除 \x、0x、空格等非16进制字符
            const cleanHex = hexInput
                .replace(/\\x|0x/gi, '')
                .replace(/\s+/g, '');
            
            // 验证是否为有效16进制
            if (!/^[0-9a-fA-F]+$/.test(cleanHex) || cleanHex.length % 2 !== 0) {
                throw new Error("无效的16进制格式");
            }
            
            let str = '';
            for (let i = 0; i < cleanHex.length; i += 2) {
                const hexByte = cleanHex.substr(i, 2);
                str += String.fromCharCode(parseInt(hexByte, 16));
            }
            return str;
        }

        // 界面交互逻辑
        document.getElementById('convertBtn').addEventListener('click', () => {
            const input = document.getElementById('inputString').value;
            const format = document.getElementById('format').value;
            
            if (!input) {
                alert("请输入要转换的字符串");
                return;
            }
            
            try {
                const output = stringToHex(input, format);
                document.getElementById('outputResult').textContent = output;
            } catch (e) {
                alert(`转换失败: ${e.message}`);
            }
        });

        document.getElementById('reverseBtn').addEventListener('click', () => {
            const input = document.getElementById('inputHex').value;
            
            if (!input) {
                alert("请输入16进制数据");
                return;
            }
            
            try {
                const result = hexToString(input);
                document.getElementById('reverseResult').textContent = result;
            } catch (e) {
                alert(`反向转换失败: ${e.message}`);
            }
        });

        // 复制功能
        function copyOutput() {
            copyToClipboard('outputResult', '转换结果');
        }
        
        function copyReverse() {
            copyToClipboard('reverseResult', '原始字符串');
        }
        
        function copyToClipboard(elementId, type) {
            const content = document.getElementById(elementId).textContent;
            if (!content) {
                alert(`没有可复制的${type}`);
                return;
            }
            
            navigator.clipboard.writeText(content)
                .then(() => alert(`已复制${type}到剪贴板`))
                .catch(err => alert('复制失败，请手动选择复制'));
        }
    </script>
</body>
</html>